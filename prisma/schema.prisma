generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Player {
  id          String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  firstName   String
  lastName    String
  yearOfBirth Int
  position    Position
  isRetired   Boolean         @default(false)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  histories   PlayerHistory[]
  values      PlayerValue[]
}

model Club {
  id              String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name            String
  historiesFrom   PlayerHistory[] @relation("HistoryFromClub")
  historiesTo     PlayerHistory[] @relation("HistoryToClub")
  historiesParent PlayerHistory[] @relation("HistoryParentClub")
}

model PlayerHistory {
  id       String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  playerId String @db.Uuid
  marketValue Int?
  type         HistoryType?
  eventDate    DateTime?
  fromClubId   String?      @db.Uuid
  toClubId     String?      @db.Uuid
  loanParentId String?      @db.Uuid
  loanEndAt    DateTime?
  fee          Int?

  fromClub   Club?  @relation("HistoryFromClub", fields: [fromClubId], references: [id], onDelete: SetNull)
  loanParent Club?  @relation("HistoryParentClub", fields: [loanParentId], references: [id], onDelete: SetNull)
  player     Player @relation(fields: [playerId], references: [id], onDelete: Cascade)
  toClub     Club?  @relation("HistoryToClub", fields: [toClubId], references: [id], onDelete: SetNull)

  @@index([playerId, eventDate])
}

model PlayerValue {
  id       String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  playerId String   @db.Uuid
  value    Int
  date     DateTime
  player   Player   @relation(fields: [playerId], references: [id], onDelete: Cascade)
}

enum Position {
  GK
  DF
  MF
  CF
}

enum HistoryType {
  TRANSFER
  LOAN
}
